## 二、进程管理

### 1.进程的基本概念

* **程序顺序执行的特征：**

  1）顺序性：处理机严格按照程序所规定的顺序执行，每一步操作必须在下一步操作开始前执行

  2）封闭性：程序在封闭的环境下运行，程序独占资源，资源的状态由程序决定，程序一旦开始执行，外界环境不会影响程序的执行结果。

  3）可再现性：只要程序的初始条件和环境相同，程序的执行结果就相同。

* **程序的并发执行的特征：**（顺序执行会浪费资源）

  1）间断性：程序共享系统的资源，以及为完成同一个任务共同合作，并发执行的程序之间相互制约，（不是运行完一个在运行另一个）

  2）失去封闭性：各程序共享系统资源，资源的状态由各程序所决定。

  3）不可再现性：由于失去了封闭性，（即初始的环境状态和条件相同，程序的执行结果却可能不同），该特征超级垃圾，必须想办法避免。

* **进程的概念：**

  一般认识：

  - 程序在并发环境中的执行过程。
  - *系统进行资源分配和调度的一个独立单位

  总结定义：

  - 进程是进程实体的运行过程，是系统进行资源分配和调度的一个独立单位

* **进程的特征：**

  - 结构特征：

    | PCB（进程控制块），与进程共存亡，用于记录进程的基本情况和活动过程，一般常驻内存 |
    | :----------------------------------------------------------: |
    |   程序段（一般为需要的时候动态调入内存），描述要完成的功能   |
    |  数据段（一般为需要的时候动态调入内存），操作的对象即工作区  |

  - 动态性：进程最基本的特征，进程不是静态的，而是动态的，它由创建而产生，由调度（这里主要指**进程调度**，而不是作业调度）而执行，由撤销而消亡

  - 并发性：指多个进程实体存于内存中，且能在同一时间段内执行，（这里同操作系统的并发性）

  - 独立性：进程实体是一个能独立运行，独立获得资源和独立接收调度的基本单位

  - 异步性：同操作系统的异步性

* **进程的三种基本状态：**

  * 就绪状态：进程已经分配到除了CPU之外的所有资源，只要获得CPU便可以立刻执行，处于就绪状态的进程维持一个就绪队列。
  * 执行状态：已经获得CPU，正在执行的进程。（单处理机系统中，同一时刻只能有一个进程处于执行状态，多处理机系统中，可以同时有多个进程处于执行态）
  * 阻塞状态/等待状态：在执行的过程中由于发生某些事件（I/O请求，申请缓存等），暂时无法执行的进程，是由于进程本身引起的阻塞。处于阻塞状态的进程可以维持一个阻塞队列。

* **三种基本状态的转换：**

![1549006581917](./img/1549006581917.png)

​	就绪—>执行：进程调度，获得CPU资源

​	执行—>就绪：在分时操作系统中时间片花完

​	执行—>阻塞：I/O请求，申请缓存等，自己被迫进入阻塞状态

​	阻塞—>就绪：I/O完成，造成阻塞的原因得到解决

* **进程的创建状态和终止状态**

  创建状态：进程成为就绪状态之前的状态

  终止状态：当一个进程到达了自然结束点，或者遇到无法客服的困难，或者被操作系统所终结等的时候，就进入了终止状态。

* **挂起操作及引入的原因：**

  1）进程被挂起之后处于静止状态。

  2）引入的原因：

  * 终端用户的需要：当终端用户想要暂停自己程序的运行的时候
  * 父进程请求：当父进程想要挂起某个子进程的时候
  * 负荷调节的需要：当实时系统中的工作负荷较重，系统可以将某些不重要的进程挂起，保证程序的正常运行。
  * 操作系统的需要：操作系统有事需要将某些进程挂起，已检查运行过程中资源的使用情况

  3）引入挂起操作后，进程的状态转换：

  ![20190201](./img/20190201.png)

  1）阻塞态可以通过释放变为就绪态。活动阻塞释放变为活动就绪，静止阻塞释放变为静止就绪。

  2）活动态和静止态可以进行相互转换，活动到静止称为挂起，静止到活动可以称为激活。**活动态和静止态最本质的区别为活动态在内存中，静止态暂时调出内存，进入外存**

  3）有执行态可以直接变为静止就绪态，即时间片用完，直接调离内存

  4）静止态（外存）必须通过激活变为非静止态（调入内存）才能够参与进程的三台转换。

* **进程管理中的数据结构**

  * 操作系统中用于管理控制的数据结构：内存表，设备表，文件表，进程表（程序控制快PCB）

  * **进程控制块PCB的作用：**

    * PCB作为进程实体的一部分，用于描述进程的当前情况以及管理进程运行的全部信息，是操作系统中最重要的记录型数据结构。
    * OS用PCB对并发进程进行管理和控制
    * PCB是进程存在的唯一标志
    * PCB是常驻内存的
    * OS专门开辟PCB区，将所有的PCB组成若干个链表或队列。
    * 能实现间断性的运行方式。

  * 进程控制块中的信息：

    * 进程标识符：唯一表示一个进程，有两种：

      1）外部标识符：方便用户对进程的访问，通常有数字和字母组成

      2）内部标识符：方便系统对进程的访问，每一个进程有一个唯一的数字标识符。

    * 处理机状态：（主要指的是处理机中寄存器的状态）

      1）通用寄存器：又称为用户寄存器，用户的程序可以访问，用于暂存信息，一般为8~32个

      2）指令计数器：存放了将要访问的下一条指令的地址。

      3）程序状态字（$PSW$）：含有状态信息，条件码，执行方式（指在系统还是用户状态下执行），中断屏蔽标志（允不允许在执行的过程中被打断）

      4）用户栈指针：每个用户进程都有系统栈，用于存放过程和系统调用参数及调用地址。

    * 进程调度信息

      1）进程状态：指明了进程的当前状态

      2）进程优先级：即一个整数，用于描述进程使用CPU的优先级，数字越大，优先级越高

      3）其他信息：与采用的进程调度算法有关

      4）事件：指进程由执行状态变为阻塞状态所等待发生的事件。

    * 进程控制信息

      1）程序和数据的地址：由于程序段和数据段并不是常驻内存的，而是使用的时候才调入，因此需要保存其地址

      2）进程同步和通信机制：

      3）资源清单：一张清单列出了该进程在运行期间所需的全部资源（除了CPU资源），另一张列出了分配到该进程的资源的清单。

      4）链接指针：给出了本进程（PCB）所在队列中的下一个进程的PCB的首地址。

  * 进程控制块的组织方式：

    * 线性方式：不重要
    * 链接方式：类似静态链表，把具有同一状态的PCB用其中的链接字链接成一个队列，如下图：

    > 0代表结束

    ![1549082269985](img/20190202.png)

    * 索引方式：

    ![1549082567747](./img/1549082567747.png)

  > 注：进程资源的分配并不是在该进程执行之前将该进程所需的资源全部分配给他，而是在其执行的过程中进行动态的分配。

### 2.进程与程序的区别与关系

* 进程与程序的区别：
  * 进程是一个动态的概念（有 “ 生命 ” ），程序是静态的概念。
  * 进程可以具有并行性（在多处理器的系统中），但是程序没有
  * 进程是竞争系统资源的基本单位
* 进程与程序的关系：
  * 一个程序对应多个进程，一个进程又可以为多个程序服务。

### 3.进程控制

#### 1.基本知识

* 进程控制是进程管理中最基本的功能，主要包括进程的创建，进程的终止和运行中的进程的状态转换等功能。进程控制一般是由**OS的内核中的原语**来实现的。

#### 2.进程的创建

* 进程的层次结构
* 进程图
* **引起进程创建的事件**
  * 用户登录：在分时系统中，用户成功登录，系统将为该用户分配新的进程
  * 作业调度：在多道批处理系统中，作业调度程序将某些作业调度内存，并且为他们创建进程
  * 提供服务：运行中的用户程序提出某种请求
  * 应用请求：由用户进程自己创建，帮助自己完成特定的任务
* ==进程的创建过程：==OS调用进程创建原语Create创建一个新进程
  * 申请空白PCB：新进程获得一个唯一的**数字标识符（对于操作系统）**
  * 为新进程分配器运行所需的资源：包括**物理资源和逻辑资源**
  * 初始化进程控制块PCB：
    * 初始化标识符信息：系统分配的标识符信息装入PCB
    * 初始化处理机状态信息：主要为一些寄存器
    * 初始化处理机控制信息：一般初始化为就绪状态
  * 如果进程就绪队列允许，将进程插入就绪队列

#### 3.进程的终止

* 引起进程终止的事件：
  * 正常结束：完事了
  * 异常结束：1）越界错误（访问自己范围外的），2）保护错误（访问自己无权利访问的）3）非法指令：试图运行不存在的指令，4）特权指令；5）运行超时；6）等待超时；7）算术运算错；8）I/O故障
  * 外界的干预：1）操作员或者操作系统干预；2）父进程的请求（父进程的权利大于子进程）3）父进程的终止：当父进程终止时，其所有子进程也应当终止。
* ==进程终止的过程：==
  * 根据要终止的进程的标识符，搜索出该进程的PCB，从中获得该进程所处的状态
  * 如果该进程正处于执行状态，立刻终止该进程，并且置调度标志为真，表示在该进程结束后应该进行重新调度（即不要让CPU空闲） 
  * 若该进程有子孙进程，让其所有子孙进程都终止。
  * 被终止进程所拥有的所有资源归还给父进程或者操作系统
  * 将终止进程的PCB从所在队列中移除，等待其他程序来收集信息。

#### 4.进程的阻塞与唤醒

* 引起进程阻塞和唤醒的事件：阻塞和唤醒是相对应的
  * 向系统请求共享资源失败
  * 等待某种操作的完成
  * 新数据尚未到达
  * 等待新任务的到达
* 进程阻塞的过程
* 进程唤醒的过程

#### 5.进程的挂起与激活

### 4.进程同步

### 5.进程通信

### 6.线程

